<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom styles for the Inter font and general layout */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6; /* Light gray background */
      display: flex;
      justify-content: center;
      align-items: flex-start; /* Align to start to allow content to flow */
      min-height: 100vh;
      padding: 2rem;
      box-sizing: border-box;
    }
    .container {
      background-color: #ffffff;
      padding: 2.5rem;
      border-radius: 0.75rem; /* rounded-xl */
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
      max-width: 900px; /* Max width for better readability */
      width: 100%;
    }
    h1, h2 {
      color: #1f2937; /* Dark gray text */
      margin-bottom: 1.5rem;
      text-align: center;
    }
    form label {
      font-weight: 500; /* Medium font weight */
      color: #374151; /* Slightly lighter dark gray */
    }
    input[type="text"],
    input[type="number"],
    input[type="password"],
    textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #d1d5db; /* Light gray border */
      border-radius: 0.5rem; /* rounded-md */
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      box-sizing: border-box; /* Include padding in width */
    }
    button {
      background-color: #4f46e5; /* Indigo 600 */
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem; /* rounded-md */
      font-weight: 600; /* Semibold */
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
      width: 100%; /* Full width button */
    }
    button:hover {
      background-color: #4338ca; /* Indigo 700 */
    }
    p {
      margin-top: 1rem;
      text-align: center;
      color: #4b5563; /* Gray 600 */
    }
    .error-message {
      color: #ef4444; /* Red 500 */
      font-weight: 500;
      margin-top: 1rem;
    }
    .hidden {
      display: none;
    }
    .announcement-info {
  white-space: pre-line;
}

  </style>
</head>
<body>
  <div class="container">
    <div id="login-section">
      <h1 class="text-3xl font-bold mb-6">Admin Login</h1>
      <form id="login-form" class="space-y-4">
        <div>
          <label for="username-input" class="block text-sm font-medium text-gray-700">Email:</label>
          <input type="email" id="username-input" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />
        </div>
        <div>
          <label for="password-input" class="block text-sm font-medium text-gray-700">Password:</label>
          <input type="password" id="password-input" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />
        </div>
        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Login</button>
        <p id="login-status" class="text-red-500 text-center text-sm mt-2"></p>
      </form>
    </div>

    <div id="admin-content" class="hidden">
      <h1 class="text-3xl font-bold">Update Team and Member Counts</h1>

      <form id="update-form" class="space-y-4">
        <div>
          <label for="members-input" class="block text-sm font-medium text-gray-700">Members:</label>
          <input type="number" id="members-input" required min="0" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />
        </div>
        <div>
          <label for="teams-input" class="block text-sm font-medium text-gray-700">Teams:</label>
          <input type="number" id="teams-input" required min="0" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />
        </div>
        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Update Counts</button>
      </form>
      <p id="status" class="text-center text-sm mt-2"></p>

      <h1 class="text-3xl font-bold mt-8">Admin - Update Announcements</h1>

      <form id="announcement-form" class="space-y-4">
        <h2 class="text-2xl font-semibold mt-6">தமிழ் அறிவிப்பு</h2>
        <div>
          <label for="english-title" class="block text-sm font-medium text-gray-700">Title:</label>
          <input type="text" id="english-title" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />
        </div>
        <div>
          <label for="english-info" class="block text-sm font-medium text-gray-700">Info:</label>
          <textarea id="english-info" rows="4" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
        </div>

        <h2 class="text-2xl font-semibold mt-6">English Announcements</h2>
        <div>
          <label for="tamil-title" class="block text-sm font-medium text-gray-700">தலைப்பு:</label>
          <input type="text" id="tamil-title" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />
        </div>
        <div>
          <label for="tamil-info" class="block text-sm font-medium text-gray-700">தகவல்:</label>
          <textarea id="tamil-info" rows="4" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
        </div>

        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Update Announcements</button>
      </form>
      <p id="announcement-status" class="text-center text-sm mt-2"></p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    // Initialize Supabase client (kept as per your original code for data operations)
    const supabaseUrl = 'https://fdbesnvsaaugbkdkkmxz.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZkYmVzbnZzYWF1Z2JrZGtrbXh6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5MzEyMjYsImV4cCI6MjA2NDUwNzIyNn0.hDev995HD6sOdyIkO4uoKjxCDPfhYFfnbSGLc1amlio';
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    // --- Login Elements ---
    const loginSection = document.getElementById('login-section');
    const adminContent = document.getElementById('admin-content');
    const loginForm = document.getElementById('login-form');
    const usernameInput = document.getElementById('username-input');
    const passwordInput = document.getElementById('password-input');
    const loginStatusP = document.getElementById('login-status');

    // --- Admin Dashboard Elements (from your original code) ---
    const countsRowId = 'a1d46fc9-df89-4171-98dc-700bd90f249e';
    const form = document.getElementById('update-form');
    const membersInput = document.getElementById('members-input');
    const teamsInput = document.getElementById('teams-input');
    const statusP = document.getElementById('status');

    const tamilId = 'a355ab9c-8968-4b94-a665-90111255b374';
    const englishId = '3c779815-d3aa-41c0-a5ce-1261251451e1';
    const englishTitle = document.getElementById('english-title');
    const englishInfo = document.getElementById('english-info');
    const tamilTitle = document.getElementById('tamil-title');
    const tamilInfo = document.getElementById('tamil-info');
    const announcementStatus = document.getElementById('announcement-status');

    // --- Login Logic ---
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault(); // Prevent default form submission

      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim();

      // Hardcoded credentials
      const correctUsername = 'velankanniwalkerssocialservice@gmail.com';
      const correctPassword = 'avemariavwss';

      if (username === correctUsername && password === correctPassword) {
        loginStatusP.textContent = ''; // Clear any previous error message
        loginSection.classList.add('hidden'); // Hide login section
        adminContent.classList.remove('hidden'); // Show admin content

        // Load all data after successful login
        loadCurrentCounts();
        loadAnnouncements();
      } else {
        loginStatusP.textContent = 'Invalid username or password.';
        loginStatusP.classList.add('error-message'); // Add error styling
      }
    });

    // --- Supabase Data Loading and Update Functions (from your original code) ---

    // Load current counts from Supabase
    async function loadCurrentCounts() {
      try {
        const { data, error } = await supabaseClient
          .from('counts')
          .select('members, teams')
          .eq('id', countsRowId)
          .single();

        if (error) {
          statusP.textContent = 'Error loading counts: ' + error.message;
          statusP.classList.add('error-message');
          return;
        }

        membersInput.value = data.members ?? 0;
        teamsInput.value = data.teams ?? 0;
        statusP.textContent = ''; // Clear status after load
      } catch (e) {
        statusP.textContent = 'An unexpected error occurred while loading counts.';
        statusP.classList.add('error-message');
        console.error(e);
      }
    }

    // Handle counts form submit
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusP.textContent = 'Updating...';
      statusP.classList.remove('error-message'); // Clear error styling

      const members = parseInt(membersInput.value);
      const teams = parseInt(teamsInput.value);

      if (isNaN(members) || isNaN(teams) || members < 0 || teams < 0) {
        statusP.textContent = 'Please enter valid non-negative numbers for members and teams.';
        statusP.classList.add('error-message');
        return;
      }

      try {
        const { error } = await supabaseClient
          .from('counts')
          .update({ members, teams })
          .eq('id', countsRowId);

        if (error) {
          statusP.textContent = 'Update failed: ' + error.message;
          statusP.classList.add('error-message');
          return;
        }

        statusP.textContent = 'Counts updated successfully!';
        statusP.classList.remove('error-message');
      } catch (e) {
        statusP.textContent = 'An unexpected error occurred during counts update.';
        statusP.classList.add('error-message');
        console.error(e);
      }
    });

    // Load announcements data from Supabase
    async function loadAnnouncements() {
      try {
        const { data, error } = await supabaseClient
          .from('announcements')
          .select('*')
          .in('id', [tamilId, englishId]);

        if (error) {
          announcementStatus.textContent = 'Error loading announcements: ' + error.message;
          announcementStatus.classList.add('error-message');
          return;
        }

        data.forEach(row => {
          if (row.id === englishId) {
            englishTitle.value = row.title || '';
            englishInfo.value = row.info || '';
          } else if (row.id === tamilId) {
            tamilTitle.value = row.title || '';
            tamilInfo.value = row.info || '';
          }
        });
        announcementStatus.textContent = ''; // Clear status after load
      } catch (e) {
        announcementStatus.textContent = 'An unexpected error occurred while loading announcements.';
        announcementStatus.classList.add('error-message');
        console.error(e);
      }
    }

    // Handle announcements form submit
    document.getElementById('announcement-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      announcementStatus.textContent = 'Updating...';
      announcementStatus.classList.remove('error-message'); // Clear error styling

      const now = new Date().toISOString();

      const updates = [
        {
          id: englishId,
          title: englishTitle.value.trim(),
          info: englishInfo.value.trim(),
          updated_at: now
        },
        {
          id: tamilId,
          title: tamilTitle.value.trim(),
          info: tamilInfo.value.trim(),
          updated_at: now
        }
      ];

      let success = true;
      let errorMessage = '';

      for (const update of updates) {
        try {
          const { error } = await supabaseClient
            .from('announcements')
            .update({
              title: update.title,
              info: update.info,
              updated_at: update.updated_at
            })
            .eq('id', update.id);

          if (error) {
            success = false;
            errorMessage = 'Error updating ' + (update.id === englishId ? 'English' : 'Tamil') + ' announcement: ' + error.message;
            break;
          }
        } catch (e) {
          success = false;
          errorMessage = 'An unexpected error occurred during announcement update.';
          console.error(e);
          break;
        }
      }

      if (success) {
        announcementStatus.textContent = 'Announcements updated successfully!';
        announcementStatus.classList.remove('error-message');
      } else {
        announcementStatus.textContent = errorMessage;
        announcementStatus.classList.add('error-message');
      }
    });

    // Initial state: Hide admin content until logged in
    adminContent.classList.add('hidden');
    loginSection.classList.remove('hidden'); // Ensure login section is visible initially
  </script>
</body>
</html>
